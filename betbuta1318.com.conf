<VirtualHost 208.84.102.150:80 [2602:fb54:1400::118]:80>
    SuexecUserGroup #1001 #1001
    ServerName betbuta1318.com
    ServerAlias www.betbuta1318.com
    ServerAlias mail.betbuta1318.com
    ServerAlias webmail.betbuta1318.com
    ServerAlias admin.betbuta1318.com
    DocumentRoot /home/betbuta1318/public_html
    ErrorLog /var/log/virtualmin/betbuta1318.com_error_log
    CustomLog /var/log/virtualmin/betbuta1318.com_access_log combined
    ScriptAlias /cgi-bin/ /home/betbuta1318/cgi-bin/
    ScriptAlias /awstats /home/betbuta1318/cgi-bin/awstats.pl
    DirectoryIndex index.php index.htm index.html
    
    # Node.js ProxyPass Configuration - Ana domain için
    ProxyPreserveHost On
    ProxyPass /.well-known !
    ProxyPass /cgi-bin/ !
    ProxyPass /awstats !
    ProxyPass /icon/ !
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # WebSocket desteği (gerekirse)
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteCond %{HTTP_HOST} ^(www\.)?betbuta1318\.com$ [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]
    
    # Virtualmin özel yönlendirmeleri
    RewriteCond %{HTTP_HOST} =webmail.betbuta1318.com
    RewriteRule ^/(?!.well-known)(.*)$ https://betbuta1318.com:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.betbuta1318.com
    RewriteRule ^/(?!.well-known)(.*)$ https://betbuta1318.com:10000/ [R]
    
    <Directory /home/betbuta1318/public_html>
        Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    <Directory /home/betbuta1318/cgi-bin>
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    
    RemoveHandler .php
    RemoveHandler .php8.3
    <FilesMatch \.php$>
        SetHandler proxy:unix:/run/php/17562474931797923.sock|fcgi://127.0.0.1
    </FilesMatch>
    RedirectMatch ^/awstats$ /awstats/
    <Files awstats.pl>
        AuthName "betbuta1318.com statistics"
        AuthType Basic
        AuthUserFile /home/betbuta1318/.awstats-htpasswd
        require valid-user
    </Files>
</VirtualHost>

<VirtualHost 208.84.102.150:443 [2602:fb54:1400::118]:443>
    SuexecUserGroup #1001 #1001
    ServerName betbuta1318.com
    ServerAlias www.betbuta1318.com
    ServerAlias mail.betbuta1318.com
    ServerAlias webmail.betbuta1318.com
    ServerAlias admin.betbuta1318.com
    DocumentRoot /home/betbuta1318/public_html
    ErrorLog /var/log/virtualmin/betbuta1318.com_error_log
    CustomLog /var/log/virtualmin/betbuta1318.com_access_log combined
    ScriptAlias /cgi-bin/ /home/betbuta1318/cgi-bin/
    ScriptAlias /awstats /home/betbuta1318/cgi-bin/awstats.pl
    DirectoryIndex index.php index.htm index.html
    
    # Node.js ProxyPass Configuration - HTTPS için
    ProxyPreserveHost On
    ProxyPass /.well-known !
    ProxyPass /cgi-bin/ !
    ProxyPass /awstats !
    ProxyPass /icon/ !
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # WebSocket desteği (gerekirse)
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteCond %{HTTP_HOST} ^(www\.)?betbuta1318\.com$ [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]
    
    # Virtualmin özel yönlendirmeleri
    RewriteCond %{HTTP_HOST} =webmail.betbuta1318.com
    RewriteRule ^/(?!.well-known)(.*)$ https://betbuta1318.com:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.betbuta1318.com
    RewriteRule ^/(?!.well-known)(.*)$ https://betbuta1318.com:10000/ [R]
    
    <Directory /home/betbuta1318/public_html>
        Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    <Directory /home/betbuta1318/cgi-bin>
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    
    SSLEngine on
    SSLCertificateFile /etc/ssl/virtualmin/17562474931797923/ssl.cert
    SSLCertificateKeyFile /etc/ssl/virtualmin/17562474931797923/ssl.key
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCACertificateFile /etc/ssl/virtualmin/17562474931797923/ssl.ca
    
    RemoveHandler .php
    RemoveHandler .php8.3
    <FilesMatch \.php$>
        SetHandler proxy:unix:/run/php/17562474931797923.sock|fcgi://127.0.0.1
    </FilesMatch>
    RedirectMatch ^/awstats$ /awstats/
    <Files awstats.pl>
        AuthName "betbuta1318.com statistics"
        AuthType Basic
        AuthUserFile /home/betbuta1318/.awstats-htpasswd
        require valid-user
    </Files>
</VirtualHost>